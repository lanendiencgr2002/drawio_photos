<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.7.5 Chrome/126.0.6478.183 Electron/31.3.0 Safari/537.36" version="24.7.5">
  <diagram name="第 1 页" id="xM4GF8KPHChY5Br-Ip8q">
    <mxGraphModel dx="789" dy="583" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="qZgSJdFSMBtpXcKxQKuz-1" value="在实际的企业开发过程中，你会发现外键是被严格禁止使用的，当需要多个表之间进行关联时，做法是冗余相关字段，而不是建立外键。" style="text;whiteSpace=wrap;html=1;fontSize=18;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="20" y="50" width="572.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qZgSJdFSMBtpXcKxQKuz-2" value="成绩表（成绩 id、学生 id，分数），对于成绩表来说，学生 id 就是外键" style="text;whiteSpace=wrap;html=1;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="20" y="150" width="625" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qZgSJdFSMBtpXcKxQKuz-3" value="&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;CREATE&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;TABLE&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`score`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;(&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`id`&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #e6c07b;line-height: 26px;&quot;&gt;&lt;span&gt;bigint&lt;/span&gt;&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;color: #d19a66;line-height: 26px;&quot;&gt;&lt;span&gt;20&lt;/span&gt;&lt;/span&gt;&lt;span&gt;)&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;unsigned&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;NOT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;line-height: 26px;&quot;&gt;&lt;span&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;AUTO_INCREMENT&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;&#39;成绩 id&#39;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`student_id`&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #e6c07b;line-height: 26px;&quot;&gt;&lt;span&gt;bigint&lt;/span&gt;&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;color: #d19a66;line-height: 26px;&quot;&gt;&lt;span&gt;20&lt;/span&gt;&lt;/span&gt;&lt;span&gt;)&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;unsigned&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;NOT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;line-height: 26px;&quot;&gt;&lt;span&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;&#39;学生id&#39;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`score`&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #e6c07b;line-height: 26px;&quot;&gt;&lt;span&gt;int&lt;/span&gt;&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;color: #d19a66;line-height: 26px;&quot;&gt;&lt;span&gt;20&lt;/span&gt;&lt;/span&gt;&lt;span&gt;)&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;unsigned&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;NOT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #56b6c2;line-height: 26px;&quot;&gt;&lt;span&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;&#39;分数&#39;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp; PRIMARY&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;KEY&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`id`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;),&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;KEY&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`student_id`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;(&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;`student_id`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;),&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#ff0000&quot;&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;CONSTRAINT&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;`fk_student_id`&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;FOREIGN&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;KEY&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;(&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;`student_id`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;)&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;REFERENCES&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;`student`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;(&lt;/span&gt;&lt;span style=&quot;line-height: 26px;&quot;&gt;&lt;span&gt;`id`&lt;/span&gt;&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;/font&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;)&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;ENGINE&lt;/span&gt;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;InnoDB&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;DEFAULT&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;CHARSET&lt;/span&gt;&lt;/span&gt;&lt;span&gt;=utf8mb4&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #c678dd;line-height: 26px;&quot;&gt;&lt;span&gt;COMMENT&lt;/span&gt;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span style=&quot;color: #98c379;line-height: 26px;&quot;&gt;&lt;span&gt;&#39;成绩表&#39;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="20" y="180" width="720" height="210" as="geometry" />
        </mxCell>
        <UserObject label="&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;外键和主键一样，都是一种约束，外键约束也称为引用约束或引用完整性约束）：&lt;/span&gt;&lt;/p&gt;&lt;ol style=&quot;margin-top: 8px;margin-bottom: 8px;padding-left: 25px;&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;外键列必须引用另一个表中的主键或唯一键列；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;外键列必须满足引用完整性，也就是说，它们包含的值必须存在于被引用表的主键或唯一键列中。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;通俗来说：&lt;/span&gt;&lt;/p&gt;&lt;ol style=&quot;margin-top: 8px;margin-bottom: 8px;padding-left: 25px;&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;成绩表插入数据时，student_id 必须是学生表已存在的 id；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;学生表删除/更新数据时，会自动删除/更新成绩表中引用 student.id 的数据（级联）。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;" link="&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;外键和主键一样，都是一种约束，外键约束也称为引用约束或引用完整性约束）：&lt;/span&gt;&lt;/p&gt;&lt;ol style=&quot;margin-top: 8px;margin-bottom: 8px;padding-left: 25px;&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;外键列必须引用另一个表中的主键或唯一键列；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;外键列必须满足引用完整性，也就是说，它们包含的值必须存在于被引用表的主键或唯一键列中。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;通俗来说：&lt;/span&gt;&lt;/p&gt;&lt;ol style=&quot;margin-top: 8px;margin-bottom: 8px;padding-left: 25px;&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;成绩表插入数据时，student_id 必须是学生表已存在的 id；&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section style=&quot;margin-top: 5px;margin-bottom: 5px;color: rgb(1, 1, 1);line-height: 1.8em;letter-spacing: 0em;&quot;&gt;&lt;span&gt;学生表删除/更新数据时，会自动删除/更新成绩表中引用 student.id 的数据（级联）。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;" id="qZgSJdFSMBtpXcKxQKuz-4">
          <mxCell style="text;whiteSpace=wrap;html=1;fontSize=18;" vertex="1" parent="1">
            <mxGeometry x="20" y="420" width="560" height="390" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="qZgSJdFSMBtpXcKxQKuz-5" value="为什么不推荐使用外键？" style="text;whiteSpace=wrap;html=1;fontSize=18;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="27.5" y="820" width="212.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qZgSJdFSMBtpXcKxQKuz-6" value="&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;定义外键之后，数据库的每次操作都需要去检查外键约束。对于插入来说，影响了插入速度；对于更新来说，级联更新是强阻塞，存在数据库更新风暴（Database Update Storm）的风险。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;所谓 Database Update Storm，指的是在高并发环境下，多个客户端同时对数据库进行大量的更新操作，存在锁竞争问题甚至死锁，从而导致数据库性能急剧下降或完全崩溃。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;另外，当数据量非常大的时候，常见手段是分库分表，但外键通常难以跨越不同数据库来建立联系，数据的一致性更难维护。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; style=&quot;font-size: 15px;line-height: 1.75;letter-spacing: 0.2em;text-indent: 0em;padding-top: 8px;padding-bottom: 8px;margin: 10px;word-spacing: 0.1em;&quot;&gt;&lt;span&gt;因此，外键与级联并不适合分布式、高并发集群，但单机低并发业务可以考虑使用外键保证一致性和完整性。&lt;/span&gt;&lt;/p&gt;" style="text;whiteSpace=wrap;html=1;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="27.5" y="850" width="560" height="450" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
